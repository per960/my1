
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Scheduled Video Player</title>
<style>
  body {font-family: Arial, Helvetica, sans-serif; background:#111; color:#eee; margin:0; }
  #player { width:100%; height:100vh; border:none; }
  #info { position:absolute; top:10px; left:10px; background:rgba(0,0,0,0.6); padding:8px 12px; border-radius:4px; }
  .hidden { display:none; }
</style>
</head>
<body>

<div id="info">Loading scheduleâ€¦</div>
<iframe id="player" src="" allow="autoplay; encrypted-media" allowfullscreen></iframe>

<script>
/* --------------------------------------------------------------
   Helper: parse "HH:MM" â†’ minutes since midnight (local time)
   -------------------------------------------------------------- */
function timeStringToMinutes(str) {
  const [h, m] = str.split(':').map(Number);
  return h * 60 + m;
}

/* --------------------------------------------------------------
   Load the schedule JSON (requires a server â€“ see note below)
   -------------------------------------------------------------- */
async function loadSchedule() {
  const resp = await fetch('schedule.json');
  if (!resp.ok) throw new Error('Failed to load schedule.json');
  return await resp.json();
}

/* --------------------------------------------------------------
   Find the entry that matches the current local time
   -------------------------------------------------------------- */
function findCurrentEntry(schedule) {
  const now = new Date();
  const minutesNow = now.getHours() * 60 + now.getMinutes();

  return schedule.find(item => {
    const start = timeStringToMinutes(item.start);
    const end   = timeStringToMinutes(item.end);
    // allow start <= now < end (end is exclusive)
    return minutesNow >= start && minutesNow < end;
  });
}

/* --------------------------------------------------------------
   Main driver â€“ updates the iframe src whenever the schedule changes
   -------------------------------------------------------------- */
async function initPlayer() {
  const infoEl = document.getElementById('info');
  const player = document.getElementById('player');

  let schedule;
  try {
    schedule = await loadSchedule();
    infoEl.textContent = 'Schedule loaded â€“ waiting for the right slotâ€¦';
  } catch (e) {
    console.error(e);
    infoEl.textContent = 'âŒ Could not load schedule.json';
    return;
  }

  // ----------------------------------------------------------------
  // Update function â€“ called immediately and then every 30â€¯seconds
  // ----------------------------------------------------------------
  const update = () => {
    const entry = findCurrentEntry(schedule);
    if (entry) {
      if (player.src !== entry.url) {
        player.src = entry.url;               // change video
        infoEl.textContent = `${entry.title} (${entry.start}â€‘${entry.end})`;
        console.log(`[${new Date().toLocaleTimeString()}] Playing: ${entry.title}`);
      }
    } else {
      // No scheduled video â†’ show a placeholder or a default video
      if (player.src !== '') player.src = '';
      infoEl.textContent = 'ðŸ”Ž No video scheduled right now.';
    }
  };

  // Run now, then repeat
  update();
  setInterval(update, 30_000);   // 30â€¯seconds â€“ tweak as you like
}

/* --------------------------------------------------------------
   Kick it off
   -------------------------------------------------------------- */
initPlayer();
</script>
</body>
</html>